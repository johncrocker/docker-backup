FROM alpine:3.20.1

RUN apk add --no-cache curl jq xz docker bash tzdata bzip2

VOLUME /source
VOLUME /target
VOLUME /logs

ENV TZ=UTC
ENV BACKUP_PAUSECONTAINERS="false"
ENV BACKUP_LOGLEVEL="trace"
ENV BACKUP_STORE="/target"
ENV BACKUP_SOURCE="/source"
ENV BACKUP_COMPRESS="false"
ENV BACKUP_COMPRESS_METHOD="gzip"
ENV BACKUP_COMPRESS_XZ_OPT=-"2 -T0"
ENV BACKUP_COMPRESS_BZ2_OPT=""
ENV BACKUP_DOCKERIMAGE="alpine:3.20.1"
ENV BACKUP_RETENTION_DAYS="0"

ENV NOTIF_LOGLEVEL="error"
ENV NOTIF_GOTIFY_ENABLE="false"
ENV NOTIF_GOTIFY_TOKEN=""
ENV NOTIF_GOTIFY_SERVER_URL=""
ENV NOTIF_GOTIFY_PRIORITY="5"
ENV NOTIF_APPRISE_ENABLE="false"
ENV NOTIF_APPRISE_URLS=""
ENV NOTIF_APPRISE_SERVER_URL=""
ENV NOTIF_MATTERMOST_ENABLE="false"
ENV NOTIF_MATTERMOST_HOST=""
ENV NOTIF_MATTERMOST_KEY=""
ENV NOTIF_DISCORD_ENABLE="false"
ENV NOTIF_DISCORD_WEBHOOK_ID=""
ENV NOTIF_DISCORD_TOKEN=""
ENV NOTIF_DISCORD_USERNAME=""
ENV NOTIF_PUSHOVER_ENABLE="false"
ENV NOTIF_PUSHOVER_APP_TOKEN=""
ENV NOTIF_PUSHOVER_USER_KEY=""
ENV NOTIF_PUSHOVER_PRIORITY="0"

WORKDIR /app

COPY ./backup/docker-backup.sh /app/docker-backup.sh
COPY ./entrypoint.sh /app/entrypoint.sh
RUN chmod +x /app/docker-backup.sh
RUN chmod +x /app/entrypoint.sh

ENTRYPOINT [ "/bin/sh", "-c", "/app/entrypoint.sh" ]

